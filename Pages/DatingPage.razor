@page "/DatingPage"
@using System.IO
@using NaughtyChoppersDA.Entities
@using NaughtyChoppersDA.Repositories
@using NaughtyChoppersDA.Services
@using System.Linq
@inject IProfileService profileService


<h3>Singles</h3>

@if (currentProfile != null)
{
    @*  <div class="profile-container">
        <div class="profile-card">
            <div class="profile-content">
                <h4>@currentProfile.Name</h4>
                @if (imageData != null)
                {
                    <img src="@imageDataUrl" alt="Image" />
                }
                else
                {
                    <p>No image to display.</p>
                }
                <p>Date of Birth: @(((DateTime)currentProfile.DateOfBirth!).ToString("MM/dd/yyyy"))</p>
                <p>Age: @currentProfile.Age</p>
                <p>Model: @currentProfile.Model.Name</p>


                <div class="buttons">
                    <button @onclick="LikeProfile">Like</button>
                    <button @onclick="DislikeProfile">Dislike</button>
                </div>
            </div>
        </div>
    </div> *@
    <section class="section about-section" id="about">
        <div class="container">
            <div class="row align-items-center justify-content-around flex-row">
                <div class="col-lg-5 text-center">
                    <div class="about-img">
                        <MudImage ObjectFit="ObjectFit.Cover" Height="400" Width="400" Src="@imageDataUrl" Alt="Profile Image" />
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="about-text">
                        <h3 class="dark-color">@currentProfile.Name</h3>
                        <h4 class="theme-color">@currentProfile.Model.Name</h4>
                        <p>@currentProfile.PostalCode, @currentProfile.City</p>
                        <p>Age: @currentProfile.Age</p>
                        <p></p> @* Space for description *@
                        <p>
                            @for (int i = 0; i < currentProfile.HobbyInterests.Count; i++)
                            {
                                HobbyInterest currentHobbyInterest = currentProfile.HobbyInterests[i];

                                switch (i)
                                {
                                    case 0:
                                        <MudChip Class="ms-0" Variant="Variant.Outlined" Color="Color.Primary">@currentHobbyInterest.Name</MudChip>
                                        break;
                                    case 1:
                                        <MudChip Variant="Variant.Outlined" Color="Color.Secondary">@currentHobbyInterest.Name</MudChip>
                                        break;
                                    case 2:
                                        <MudChip Variant="Variant.Outlined" Color="Color.Info">@currentHobbyInterest.Name</MudChip>
                                        break;
                                    default:
                                        break;
                                }
                            }
                        </p>
                        <MudContainer Class="d-flex justify-content-around">
                            <MudTooltip Text="Dislike">
                                <MudFab Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Close" @onclick="DislikeProfile" DisableElevation>Dislike</MudFab>
                         </MudTooltip>
                         <MudTooltip Text="Like">
                             <MudFab Color="Color.Tertiary" StartIcon="@Icons.Material.Filled.Favorite" @onclick="LikeProfile" DisableElevation>Like</MudFab>
                         </MudTooltip>
                     </MudContainer>
                 </div>
             </div>
         </div>
     </div>
 </section>
    @*  <MudGrid Class="h-100">
        <MudItem xs="6" Class="h-100">
            <MudPaper Class="d-flex justify-content-center" Elevation="3">
                <MudImage ObjectFit="ObjectFit.Cover" Fluid="true" Src="@imageDataUrl" Alt="Profile Image" />
            </MudPaper>
        </MudItem>
        <MudItem xs="6">
            <MudText Class="">John Doe</MudText>
            <MudTooltip Text="Dislike">
                <MudFab Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Close" DisableElevation>Dislike</MudFab>
         </MudTooltip>
         <MudTooltip Text="Like">
             <MudFab Color="Color.Tertiary" StartIcon="@Icons.Material.Filled.Favorite" DisableElevation>Like</MudFab>
         </MudTooltip>
         <MudTabs>
             <MudTabPanel Label="Description">
                 <p>This is the profile description...</p>
             </MudTabPanel>
             <MudTabPanel Label="Interests">
                 <p>These are the profile interests...</p>
             </MudTabPanel>
         </MudTabs>
     </MudItem>
 </MudGrid> *@

}
else
{
    <p>No profiles to display.</p>
}

@code {
    IMatchingRepository matchingRepository = new MatchingRepository();

    private List<Profile> profiles = new();


    protected override void OnInitialized()
    {
        var profileId = profileService.Profile!.ProfileId;
        profiles = matchingRepository.GetFilteredListOfProfiles((Guid)profileService.Profile!.ProfileId!); // Initialize with your list of profiles
    }

    int currentIndex = 0;
    Profile currentProfile => profiles.First();
    private byte[] imageData => currentProfile.ProfileImage;
    private string imageDataUrl => imageData != null ? $"data:image/*;base64,{Convert.ToBase64String(imageData)}" : "";

    async void LikeProfile()
    {
        matchingRepository.LikeProfileAsync((Guid)profileService.Profile!.ProfileId!, (Guid)currentProfile.ProfileId!, true);
        profiles.RemoveAt(currentIndex);
    }

    async void DislikeProfile()
    {
        matchingRepository.LikeProfileAsync((Guid)profileService.Profile!.ProfileId!, (Guid)currentProfile.ProfileId!, false);
        profiles.RemoveAt(currentIndex);
    }

}
